# Kroki usage examples

Open to view source code for this examples.

I've ommited some examples from [Kroki!](https://kroki.io/examples.html) and left only those
that are realy useful in daily life of most developrs (IMHO).

If you need them - it's easy to add them into doc (as all that presented) with following template:

````R
`r ''````{r echo=FALSE, results='asis'}
  to_diagram("<dia_engine>", "<Drawing name>",
"<dia_data>
"
  )
```
````

Replace `<dia_engine>` with corresponding diagramm rendering engine and
`<dia_data>` with diagram's text description.\
*Take a NOTE: escape **every** double quotes (`"` => `\"`) in `<dia_data>`.*

Assign **UNIQUIE** `<Drawing name>`.\
*Take a NOTE: it's important that it **UNIQUE** for **WHOLE** doc.*

\newpage

## C4 Context Diagram (PlantUML+C4)

Engine: `c4plantuml`

```{r echo=FALSE, results='asis'}
  to_diagram("c4plantuml", "Example - C4 Context Diagram",
"
@startuml
!include C4_Context.puml

LAYOUT_WITH_LEGEND()

title System Context diagram for Internet Banking System

Person(customer, \"Personal Banking Customer\", \"A customer of the bank, with personal bank accounts.\")
System(banking_system, \"Internet Banking System\", \"Allows customers to view information about their bank accounts, and make payments.\")

System_Ext(mail_system, \"E-mail system\", \"The internal Microsoft Exchange e-mail system.\")
System_Ext(mainframe, \"Mainframe Banking System\", \"Stores all of the core banking information about customers, accounts, transactions, etc.\")

Rel(customer, banking_system, \"Uses\")
Rel_Back(customer, mail_system, \"Sends e-mails to\")
Rel_Neighbor(banking_system, mail_system, \"Sends e-mails\", \"SMTP\")
Rel(banking_system, mainframe, \"Uses\")
@enduml
"
  )
```

\newpage

## C4 Container Diagram (PlantUML+C4)

Engine: `c4plantuml`

> *NOTE: inserted as SVG image so text on image is not searchable. Can't insert inline due to large horizontal size*

```{r echo=FALSE, results='asis'}
  to_diagram("c4plantuml", "Example - C4 Container Diagram", inline=FALSE,
data="
@startuml
!include C4_Container.puml

LAYOUT_TOP_DOWN()
LAYOUT_WITH_LEGEND()

title Container diagram for Internet Banking System

Person(customer, Customer, \"A customer of the bank, with personal bank accounts\")

System_Boundary(c1, \"Internet Banking\") {
    Container(web_app, \"Web Application\", \"Java, Spring MVC\", \"Delivers the static content and the Internet banking SPA\")
    Container(spa, \"Single-Page App\", \"JavaScript, Angular\", \"Provides all the Internet banking functionality to cutomers via their web browser\")
    Container(mobile_app, \"Mobile App\", \"C#, Xamarin\", \"Provides a limited subset of the Internet banking functionality to customers via their mobile device\")
    ContainerDb(database, \"Database\", \"SQL Database\", \"Stores user registraion information, hased auth credentials, access logs, etc.\")
    Container(backend_api, \"API Application\", \"Java, Docker Container\", \"Provides Internet banking functionality via API\")
}

System_Ext(email_system, \"E-Mail System\", \"The internal Microsoft Exchange system\")
System_Ext(banking_system, \"Mainframe Banking System\", \"Stores all of the core banking information about customers, accounts, transactions, etc.\")

Rel(customer, web_app, \"Uses\", \"HTTPS\")
Rel(customer, spa, \"Uses\", \"HTTPS\")
Rel(customer, mobile_app, \"Uses\")

Rel_Neighbor(web_app, spa, \"Delivers\")
Rel(spa, backend_api, \"Uses\", \"async, JSON/HTTPS\")
Rel(mobile_app, backend_api, \"Uses\", \"async, JSON/HTTPS\")
Rel_Back_Neighbor(database, backend_api, \"Reads from and writes to\", \"sync, JDBC\")

Rel_Back(customer, email_system, \"Sends e-mails to\")
Rel_Back(email_system, backend_api, \"Sends e-mails using\", \"sync, SMTP\")
Rel_Neighbor(backend_api, banking_system, \"Uses\", \"sync/async, XML/HTTPS\")
@enduml
"
  )
```

\newpage

## C4 Component Diagram (PlantUML+C4)

Engine: `c4plantuml`

```{r echo=FALSE, results='asis'}
  to_diagram("c4plantuml", "Example - Component Diagram",
"
@startuml
!include C4_Component.puml

LAYOUT_WITH_LEGEND()

title Component diagram for Internet Banking System - API Application

Container(spa, \"Single Page Application\", \"javascript and angular\", \"Provides all the internet banking functionality to customers via their web browser.\")
Container(ma, \"Mobile App\", \"Xamarin\", \"Provides a limited subset ot the internet banking functionality to customers via their mobile mobile device.\")
ContainerDb(db, \"Database\", \"Relational Database Schema\", \"Stores user registration information, hashed authentication credentials, access logs, etc.\")
System_Ext(mbs, \"Mainframe Banking System\", \"Stores all of the core banking information about customers, accounts, transactions, etc.\")

Container_Boundary(api, \"API Application\") {
    Component(sign, \"Sign In Controller\", \"MVC Rest Controlle\", \"Allows users to sign in to the internet banking system\")
    Component(accounts, \"Accounts Summary Controller\", \"MVC Rest Controlle\", \"Provides customers with a summory of their bank accounts\")
    Component(security, \"Security Component\", \"Spring Bean\", \"Provides functionality related to singing in, changing passwords, etc.\")
    Component(mbsfacade, \"Mainframe Banking System Facade\", \"Spring Bean\", \"A facade onto the mainframe banking system.\")

    Rel(sign, security, \"Uses\")
    Rel(accounts, mbsfacade, \"Uses\")
    Rel(security, db, \"Read & write to\", \"JDBC\")
    Rel(mbsfacade, mbs, \"Uses\", \"XML/HTTPS\")
}

Rel(spa, sign, \"Uses\", \"JSON/HTTPS\")
Rel(spa, accounts, \"Uses\", \"JSON/HTTPS\")

Rel(ma, sign, \"Uses\", \"JSON/HTTPS\")
Rel(ma, accounts, \"Uses\", \"JSON/HTTPS\")
@enduml
"
  )
```

\newpage

## Block Diagram

Engine: `blockdiag`

```{r echo=FALSE, results='asis'}
  to_diagram("blockdiag", "Example - Block Diagram",
"
blockdiag {
blockdiag -> generates -> \"block-diagrams\";
blockdiag -> is -> \"very easy!\";

blockdiag [color = \"greenyellow\"];
\"block-diagrams\" [color = \"pink\"];
\"very easy!\" [color = \"orange\"];
}
"
  )
```

\newpage

## Digital Timing Diagram

Engine: `wavedrom`

```{r echo=FALSE, results='asis', eval=knitr::is_html_output()}
  to_diagram("wavedrom", "Example - Digital Timing Diagram",
"
{ signal: [
  { name: \"clk\",         wave: \"p.....|...\" },
  { name: \"Data\",        wave: \"x.345x|=.x\", data: [\"head\", \"body\", \"tail\", \"data\"] },
  { name: \"Request\",     wave: \"0.1..0|1.0\" },
  {},
  { name: \"Acknowledge\", wave: \"1.....|01.\" }
]}
"
  )
```

\newpage

## Bytefield

Engine: `bytefield`

```{r echo=FALSE, results='asis', eval=knitr::is_html_output()}
  to_diagram("bytefield", "Example - Bytefield",
"
(defattrs :bg-green {:fill \"#a0ffa0\"})
(defattrs :bg-yellow {:fill \"#ffffa0\"})
(defattrs :bg-pink {:fill \"#ffb0a0\"})
(defattrs :bg-cyan {:fill \"#a0fafa\"})
(defattrs :bg-purple {:fill \"#e4b5f7\"})

(defn draw-group-label-header
  \"Creates a small borderless box used to draw the textual label headers
  used below the byte labels for remotedb message diagrams.
  Arguments are the number of colums to span and the text of the
  label.\"
  [span label]
  (draw-box (text label [:math {:font-size 12}]) {:span    span
                                                  :borders #{}
                                                  :height  14}))

(defn draw-remotedb-header
  \"Generates the byte and field labels and standard header fields of a
  request or response message for the remotedb database server with
  the specified kind and args values.\"
  [kind args]
  (draw-column-headers)
  (draw-group-label-header 5 \"start\")
  (draw-group-label-header 5 \"TxID\")
  (draw-group-label-header 3 \"type\")
  (draw-group-label-header 2 \"args\")
  (draw-group-label-header 1 \"tags\")
  (next-row 18)

  (draw-box 0x11 :bg-green)
  (draw-box 0x872349ae [{:span 4} :bg-green])
  (draw-box 0x11 :bg-yellow)
  (draw-box (text \"TxID\" :math) [{:span 4} :bg-yellow])
  (draw-box 0x10 :bg-pink)
  (draw-box (hex-text kind 4 :bold) [{:span 2} :bg-pink])
  (draw-box 0x0f :bg-cyan)
  (draw-box (hex-text args 2 :bold) :bg-cyan)
  (draw-box 0x14 :bg-purple)

  (draw-box (text \"0000000c\" :hex [[:plain {:font-weight \"light\" :font-size 16}] \" (12)\"])
            [{:span 4} :bg-purple])
  (draw-box (hex-text 6 2 :bold) [:box-first :bg-purple])
  (doseq [val [6 6 3 6 6 6 6 3]]
    (draw-box (hex-text val 2 :bold) [:box-related :bg-purple]))
  (doseq [val [0 0]]
    (draw-box val [:box-related :bg-purple]))
  (draw-box 0 [:box-last :bg-purple]))

(draw-remotedb-header 0x4702 9)

(draw-box 0x11)
(draw-box 0x2104 {:span 4})
(draw-box 0x11)
(draw-box 0 {:span 4})
(draw-box 0x11)
(draw-box (text \"length\" [:math] [:sub 1]) {:span 4})
(draw-box 0x14)

(draw-box (text \"length\" [:math] [:sub 1]) {:span 4})
(draw-gap \"Cue and loop point bytes\")

(draw-box nil :box-below)
(draw-box 0x11)
(draw-box 0x36 {:span 4})
(draw-box 0x11)
(draw-box (text \"num\" [:math] [:sub \"hot\"]) {:span 4})
(draw-box 0x11)
(draw-box (text \"num\" [:math] [:sub \"cue\"]) {:span 4})

(draw-box 0x11)
(draw-box (text \"length\" [:math] [:sub 2]) {:span 4})
(draw-box 0x14)
(draw-box (text \"length\" [:math] [:sub 2]) {:span 4})
(draw-gap \"Unknown bytes\" {:min-label-columns 6})
(draw-bottom)
"
)
```

\newpage

## Packet Diagram

Engine: `packetdiag`

> *NOTE: inserted as SVG image so text on image is not searchable. Can't insert inline due to large horizontal size*

```{r echo=FALSE, results='asis'}
  to_diagram("packetdiag", "Example - Packet Diagram", inline=FALSE,
data="
packetdiag {
  colwidth = 32;
  node_height = 72;

  0-15: Source Port;
  16-31: Destination Port;
  32-63: Sequence Number;
  64-95: Acknowledgment Number;
  96-99: Data Offset;
  100-105: Reserved;
  106: URG [rotate = 270];
  107: ACK [rotate = 270];
  108: PSH [rotate = 270];
  109: RST [rotate = 270];
  110: SYN [rotate = 270];
  111: FIN [rotate = 270];
  112-127: Window;
  128-143: Checksum;
  144-159: Urgent Pointer;
  160-191: (Options and Padding);
  192-223: data [colheight = 3];
}
"
)
```

\newpage

## Sequence Diagram #1 (Mermaid)

Engine: `mermaid`

```{r echo=FALSE, results='asis', eval=knitr::is_html_output()}
  to_diagram("mermaid", "Example - Sequence Diagram - Mermaid",
"sequenceDiagram
    participant Alice
    participant Bob
    Alice->John: Hello John, how are you?
    loop Healthcheck
        John->John: Fight against hypochondria
    end
    Note right of John: Rational thoughts prevail...
    John-->Alice: Great!
    John->Bob: How about you?
    Bob-->John: Jolly good!
"
  )
```

## Sequence Diagram #2 (PlantUML)

Engine: `plantuml` (syntax very similar to mermaid)

```{r echo=FALSE, results='asis'}
  to_diagram("plantuml", "Example - Sequence Diagram - PlantUML",
"
@startuml
Alice -> Bob: Authentication Request

alt successful case

    Bob -> Alice: Authentication Accepted

else some kind of failure

    Bob -> Alice: Authentication Failure
    group My own label
    Alice -> Log : Log attack start
        loop 1000 times
            Alice -> Bob: DNS Attack
        end
    Alice -> Log : Log attack end
    end

else Another type of failure

   Bob -> Alice: Please repeat

end
@enduml
"
  )
```

\newpage

## Sequence Diagram #3 (SeqDiag)

Engine: `seqdiag`

```{r echo=FALSE, results='asis'}
  to_diagram("seqdiag", "Example - Sequence Diagram - SeqDiag",
"
seqdiag {
  browser  -> webserver [label = \"GET /index.html\"];
  browser <-- webserver;
  browser  -> webserver [label = \"POST /blog/comment\"];
  webserver  -> database [label = \"INSERT comment\"];
  webserver <-- database;
  browser <-- webserver;
}
"
  )
```

\newpage

## Commit Graph

Engine: `pikchr`

```{r echo=FALSE, results='asis', eval=knitr::is_html_output()}
  to_diagram("pikchr", "Example - Commit Graph",
"scale = 0.8
fill = white
linewid *= 0.5
circle \"C0\" fit
circlerad = previous.radius
arrow
circle \"C1\"
arrow
circle \"C2\"
arrow
circle \"C4\"
arrow
circle \"C6\"
circle \"C3\" at dist(C2,C4) heading 30 from C2
arrow
circle \"C5\"
arrow from C2 to C3 chop
C3P: circle \"C3'\" at dist(C4,C6) heading 30 from C6
arrow right from C3P.e
C5P: circle \"C5'\"
arrow from C6 to C3P chop

box height C3.y-C2.y \
    width (C5P.e.x-C0.w.x)+linewid \
    with .w at 0.5*linewid west of C0.w \
    behind C0 \
    fill 0xc6e2ff thin color gray
box same width previous.e.x - C2.w.x \
    with .se at previous.ne \
    fill 0x9accfc
\"trunk\" below at 2nd last box.s
\"feature branch\" above at last box.n

circle \"C0\" at 3.7cm south of C0
arrow
circle \"C1\"
arrow
circle \"C2\"
arrow
circle \"C4\"
arrow
circle \"C6\"
circle \"C3\" at dist(C2,C4) heading 30 from C2
arrow
circle \"C5\"
arrow
circle \"C7\"
arrow from C2 to C3 chop
arrow from C6 to C7 chop

box height C3.y-C2.y \
    width (C7.e.x-C0.w.x)+1.5*C1.radius \
    with .w at 0.5*linewid west of C0.w \
    behind C0 \
    fill 0xc6e2ff thin color gray
box same width previous.e.x - C2.w.x \
    with .se at previous.ne \
    fill 0x9accfc
\"trunk\" below at 2nd last box.s
\"feature branch\" above at last box.n
"
  )
```

\newpage

## Use Case Diagram

Engine: `plantuml`

```{r echo=FALSE, results='asis'}
  to_diagram("plantuml", "Example Block Diagram",
"
@startuml
left to right direction
skinparam packageStyle rectangle
skinparam monochrome true
actor customer
actor clerk
rectangle checkout {
  customer -- (checkout)
  (checkout) .> (payment) : include
  (help) .> (checkout) : extends
  (checkout) -- clerk
}
@enduml
"
  )
```

\newpage

## Mind Map

Engine: `plantuml`

```{r echo=FALSE, results='asis'}
  to_diagram("plantuml", "Example - Mind Map",
"
@startmindmap
skinparam monochrome true
+ OS
++ Ubuntu
+++ Linux Mint
+++ Kubuntu
+++ Lubuntu
+++ KDE Neon
++ LMDE
++ SolydXK
++ SteamOS
++ Raspbian
-- Windows 95
-- Windows 98
-- Windows NT
--- Windows 8
--- Windows 10
@endmindmap
"
  )
```

\newpage

## PlantUML (More examples)

PlantUML supports more diagram types like timing diagramm, gantt and many more.

You can use any of them just like in previous examples.

Check PlantUML docs [https://plantuml.com/](https://plantuml.com/) for filling in diagramm data.

\newpage

## Gantt

Engine: `mermaid`

```{r echo=FALSE, results='asis', eval=knitr::is_html_output()}
  to_diagram("mermaid", "Example - Gantt",
"gantt
    title A Gantt Diagram
    dateFormat  YYYY-MM-DD
    section Section
    A task           :a1, 2014-01-01, 30d
    Another task     :after a1, 20d
    section Another
    Task in sec      :2014-01-12, 12d
    another task     :24d
"
  )
```
